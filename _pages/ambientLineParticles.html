---
title: "Ambient Circles"
author_profile: true
layout: none
particles: true
---

<script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.min.js"></script>

<script>
  var canvas;
  var particles;
  var colors;
  var slider;
  var parts = 10;
  var bg = 0;
  var sizeOffset = 1;
  var lineOffset = 1;

  p5.disableFriendlyErrors = true;

  function setup() {
    canvas = createCanvas(windowWidth, windowHeight);
    fullscreen();
    canvas.position(0, 0);

    // DEBUG //
    //frameRate(12);
    // DEBUG //

    colorMode(HSB);

    colors = [
      color(210, 463, 91, .3),
      color(268, 59, 92, .3),
      color(302, 300, 93, .3),
      color(164, 250, 93, .3),
    ];

    resetSketch();
  }

  function doubleClicked() {
    if (
      mouseX > 0 &&
      mouseX < windowWidth &&
      mouseY > 0 &&
      mouseY < windowHeight
    ) {
      let fs = fullscreen();
      fullscreen(!fs);
    }

    // console.log(frameRate())
  }

  function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
  }

  function draw() {
    background(bg);
    for (let i = 0; i < particles.length; i++) {
      p = particles[i];
      if (p.time / p.speed <= 1) {
        p.time += (0.01 + p.moveSpeed) * deltaTime;

        if (p.time / p.speed <= 0.5) {
          p.moveSpeed = lerp(0, p.maxSpeed, p.time / p.speed);
        } else {
          p.moveSpeed = lerp(p.maxSpeed, 0, p.time / p.speed);
        }

        p.x = lerp(p.ox, p.v.x, p.time / p.speed);
        p.y = lerp(p.oy, p.v.y, p.time / p.speed);
      } else {
        p.v = newGoal();
        p.ox = p.x;
        p.oy = p.y;
        p.time = 0;
        p.maxSpeed = random(0.1, 2);
        p.moveSpeed = 0;
      }

      stroke(p.color);
      strokeWeight(50 * sizeOffset);
      point(p.x, p.y);
      strokeWeight(40 * sizeOffset);
      point(p.x, p.y);
      strokeWeight(30 * sizeOffset);
      point(p.x, p.y);
      strokeWeight(20 * sizeOffset);
      point(p.x, p.y);

      for (let j = 0; j < particles.length; j++) {
        let d = dist(particles[i].x, particles[i].y, particles[j].x, particles[j].y);
        if (i != j && d < 250) {
          stroke(178, 67, 81, (250 - d) / 250);
          strokeWeight(4 * lineOffset);
          line(particles[i].x, particles[i].y, particles[j].x, particles[j].y);
        }
      }
    }
  }

  function keyPressed() {
    if (keyCode == 32) {
      if (bg == 0) bg = 255;
      else if (bg == 255) bg = 0;
    } else if (keyCode == RIGHT_ARROW || keyCode == UP_ARROW) {
      lineOffset += .1;
    } else if (keyCode == LEFT_ARROW || keyCode == DOWN_ARROW) {
      lineOffset -= .1;
      if (lineOffset < 0) lineOffset = 0;
    }
  }

  function mouseWheel(event) {
    sizeOffset -= event.delta / 500;
    return false;
  }

  function resetSketch() {
    particles = [];
    for (let i = 0; i < parts; i++) {
      particles.push(new Particle(random(width), random(height)));
    }
  }

  function newGoal() {
    return new p5.Vector(random(width), random(height));
  }

  class Particle {
    constructor(_x, _y) {
      this.x = _x;
      this.y = _y;
      this.v = newGoal();
      this.ox = _x;
      this.oy = _y;
      this.speed = 2000;
      this.time = 0;
      this.color = random(colors);
      this.baseColor = this.color;
      this.colorPhase = 1;
      this.maxSpeed = random(0.1, 2);
      this.moveSpeed = 0;
    }
  }
</script>
